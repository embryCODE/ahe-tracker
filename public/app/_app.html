<blueprint>

  <cog node="content" url="data view"/>

  <data name="view"/>
  <data name="user" value="bool false"/>

  <sensor watch="login, logout" run="checkLoggedIn"/>
  <sensor watch="loggedIn" transform="toJSON" pipe="user"/>
  <sensor watch="user" transform="toView" pipe="view"/>

  <net name='login'
       url='/login'
       verb='POST'
       prop='true'/>

  <net name='logout'
       url='/logout'
       verb='POST'
       prop='true'/>

  <net name='loggedIn'
       url='/loggedin'
       verb='GET'
       prop='true'/>

</blueprint>

<display>

  <div class="header row">
    <h1 class="col-xs-10">Agnostic Healthy Eating Tracker</h1>
    <div bind="@click | *invokeLogout" class="btn btn-primary logout-btn col-xs-2">LOGOUT</div>
  </div>

  <p class="main-description">
    Eat each type of “essential” food more often than any type of “recommended” food. Eat each type of “recommended”
    food more often than any type of “acceptable” food. For extra credit, eat each of the ten food types in the
    diet-quality hierarchy more often than any food type of lower rank.
  </p>

  <hr>

  <div id="content"></div>

</display>

<script>

  $.cog({
    init: function () {
      this.checkLoggedIn()
    },
    checkLoggedIn: function () {
      this.loggedIn.request()
    },
    toView: function (user) {
      return user ? '/app/food-list.html' : '/app/login.html'
    },
    toJSON: function (data) {
      return JSON.parse(data)
    },
    invokeLogout: function () {
      this.logout.request()
    }
  })

</script>
